import{D as y,E as g,z as j,r as p,j as a,F as v,G as E,B as A}from"./index-BRxhbGLV.js";import{T as C}from"./FullScreenLoading-DMQu7Fgi.js";import{C as b}from"./CircularProgress-CZSXn4ND.js";const P=async(n,c,m)=>{const h=/(<img[^>]+src=")([^">]+)"/g,s=Array.from(m.matchAll(h)),r=s.map(async t=>{const e=t[2];return e.startsWith("https://")?e.split("/").at(-2):y(e)}),i=await Promise.all(r),f=s.map((t,e)=>{const d=`https://imagedelivery.net/ICo2WI8PXO_BVRlWfwzOww/${i[e]}/Announcements`;return{original:t[0],replacement:`${t[1]}${d}"`}});let o=m;for(const{original:t,replacement:e}of f)o=o.replace(t,e);const l=/<iframe\s+[^>]*>/i.test(o);try{await g.put(n?`/api/announcements/announcement/${n}`:"/api/announcements/announcement",{title:c,body:o,images:i,video:l?1:0})}catch{throw new Error}},$=async n=>{try{await g.delete(`/api/announcements/announcement/${n}`)}catch{throw new Error}},T=async(n,c)=>{try{await g.put(`/api/announcements/announcement/${n}/pin`,{pin:c?0:1})}catch{throw new Error}},D=({isOpen:n,onClose:c,revalidator:m,id:h,origTitle:s,origBody:r})=>{const{openSnackbar:i}=j(),[f,o]=p.useState(!1),[u,l]=p.useState(s),[t,e]=p.useState(r),w=async()=>{o(!0);try{await P(h,u,t),m(),i("success","The announcement is successfully posted!"),d()}catch(x){console.log(x),i("error","Error Occured. Please contact to the administrator.")}finally{o(!1)}};p.useEffect(()=>{l(s),e(r)},[s,r]);const d=()=>{l(s),e(r),c()};return a.jsx(v,{isOpen:n,onClose:d,maxWidth:"1300px",maxHeight:"90svh",children:f?a.jsx(b,{}):a.jsxs(a.Fragment,{children:[a.jsx(E,{id:"filled-basic",label:"Title",variant:"outlined",value:u,fullWidth:!0,onChange:x=>l(x.target.value),required:!0}),a.jsx("div",{style:{height:"65svh",width:"100%",marginTop:"1em"},children:a.jsx(C,{body:t,getBody:e})}),a.jsx(A,{variant:"outlined",disabled:u.trim()===""||t.trim()==="",onClick:w,fullWidth:!0,sx:{marginTop:"1.5em"},children:"Post"})]})})};export{D as A,$ as d,T as p};
