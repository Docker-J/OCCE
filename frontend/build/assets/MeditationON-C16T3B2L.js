import{r as t,e,X as x,i as b,j as f,B as I,F as S,C as O,aX as E,d as M,T as N,Y as k,al as F,aY as L}from"./index-C7O2x3CB.js";import{A as P}from"./Add-DPrHqnc4.js";import{I as R,a as U}from"./ImageListItem-C8PXgKrC.js";import{I as A,u as T,a as W}from"./ImagePreviews-6NsyV0mn.js";import{F as j}from"./FileUploadComponent-DunPz_EL.js";import{C as w}from"./CircularProgress-BYsvZrSQ.js";import{F as B,A as H}from"./AdminComponent-Kuz2ZndF.js";import{u as z}from"./index-BOqikxBJ.js";import{S as y}from"./Stack-DKKAb7Fb.js";const D=({posts:h})=>h.map(a=>e(R,{component:x,to:a.ID,children:e("img",{src:`https://imagedelivery.net/ICo2WI8PXO_BVRlWfwzOww/${a.Cover}/thumbnail`,alt:"thumbnail",loading:"lazy"})},a.ID)),X=t.memo(D),Y=({isOpen:h,onClose:a})=>{const{openSnackbar:s}=b(),u=()=>{o(),a()},[n,l]=t.useState([]),[c,d]=t.useState([]),p=r=>{l(i=>[...i,...r]),r.forEach(i=>{d(C=>T(C,{$push:[URL.createObjectURL(i)]}))})},g=async()=>{const r=new FormData;n.forEach(i=>{r.append("images",i)});try{v(!0),await E(r),s("success","Uploaded Succesfully!"),u()}catch(i){console.log(i),s("error","Error Occured. Please contact to the administrator.")}finally{v(!1)}},o=()=>{c.forEach(r=>URL.revokeObjectURL(r)),l([]),d([])},[m,v]=t.useState(!1);return e(O,{isOpen:h,onClose:u,maxHeight:"85vh",maxWidth:"1300px",children:m?e(w,{}):f(S,{children:[e(A,{imagesPreview:c,setImagesPreview:d,setFilesToUpload:l}),e("div",{style:{width:"100%",height:"12.75svh"},children:e(j,{accept:{"image/*":[]},handleChangeFile:p,multiple:!0})}),f("div",{style:{display:"flex",marginTop:"1.5em",width:"100%"},children:[e(I,{variant:"outlined",disabled:n.length<=0,onClick:g,fullWidth:!0,children:"Submit"}),e(I,{variant:"outlined",onClick:o,disabled:n.length<=0,fullWidth:!0,children:"Clear All"})]})]})})},J=12,_={backgroundImage:'url("/img/Online/MeditationON.webp")'},se=()=>{const h=z("(min-width:1200px)"),{openModal:a}=M(),[s,u]=t.useState([]),[n,l]=t.useState(!1),[c,d]=t.useState(null),p=async()=>{console.log("test getPosts");const o=await L(s);o.data.length>0?u(m=>[...m,...o.data]):l(!0)};t.useEffect(()=>{s.length%J!==0&&l(!0)},[s]),t.useEffect(()=>(window.onpopstate=()=>{d(!0),console.log("test restore"),u(JSON.parse(sessionStorage.getItem("posts")))},d(!1),()=>{window.onpopstate=()=>{}}),[]),t.useEffect(()=>{c!==null&&!c&&p()},[c]),t.useEffect(()=>()=>{sessionStorage.setItem("posts",JSON.stringify(s))});const g=t.useRef();return t.useEffect(()=>{g.current&&!n&&s.length>=12&&setTimeout(()=>{try{const o=g.current.clientHeight,m=window.innerHeight-500;console.log("test content",o),console.log("test screen",m),o>100&&o<m&&p()}catch{}},500)},[s]),f(S,{children:[e("div",{className:"title-wrapper",style:_,children:e("div",{className:"title",children:e(N,{variant:"h4",fontWeight:830,sx:{letterSpacing:"0.4em",pl:"0.4em",color:"white"},children:"묵상 ON"})})}),e("div",{className:"container-wrapper",children:e(k,{className:"container",sx:{px:{xs:"0 !important",md:"1.5em !important"},py:"0 !important"},children:s.length<=0?e(y,{alignItems:"center",children:e(w,{})}):e(W,{dataLength:s.length,next:p,hasMore:!n,loader:e(y,{alignItems:"center",children:e(w,{})}),scrollThreshold:1,style:{overflowY:"hidden"},children:e(U,{ref:g,cols:h?4:3,gap:3,children:e(X,{posts:s})})})})}),e(H,{children:e(B,{variant:"primary",style:{position:"fixed",right:"2vw",bottom:"3vh"},onClick:()=>a(Y,{}),children:e(P,{})})}),n&&e(F,{})]})};export{se as default};
