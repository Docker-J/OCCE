import{l as x,m as w,i as v,r as p,e as r,j as C,n as A,B as b,F as E,C as P}from"./index-C7O2x3CB.js";import{T as I}from"./FullScreenLoading-pB3fpmLT.js";import{C as S}from"./CircularProgress-BYsvZrSQ.js";const W=async(n,c,m)=>{const h=/(<img[^>]+src=")([^">]+)"/g,a=Array.from(m.matchAll(h)),o=a.map(async t=>{const e=t[2];return e.startsWith("https://")?e.split("/").at(-2):x(e)}),i=await Promise.all(o),f=a.map((t,e)=>{const d=`https://imagedelivery.net/ICo2WI8PXO_BVRlWfwzOww/${i[e]}/Announcements`;return{original:t[0],replacement:`${t[1]}${d}"`}});let s=m;for(const{original:t,replacement:e}of f)s=s.replace(t,e);const l=/<iframe\s+[^>]*>/i.test(s);try{await w.put(n?`/api/announcements/announcement/${n}`:"/api/announcements/announcement",{title:c,body:s,images:i,video:l?1:0})}catch{throw new Error}},k=async n=>{try{await w.delete(`/api/announcements/announcement/${n}`)}catch{throw new Error}},B=async(n,c)=>{try{await w.put(`/api/announcements/announcement/${n}/pin`,{pin:c?0:1})}catch{throw new Error}},D=({isOpen:n,onClose:c,revalidator:m,id:h,origTitle:a,origBody:o})=>{const{openSnackbar:i}=v(),[f,s]=p.useState(!1),[u,l]=p.useState(a),[t,e]=p.useState(o),y=async()=>{s(!0);try{await W(h,u,t),m(),i("success","The announcement is successfully posted!"),d()}catch(g){console.log(g),i("error","Error Occured. Please contact to the administrator.")}finally{s(!1)}};p.useEffect(()=>{l(a),e(o)},[a,o]);const d=()=>{l(a),e(o),c()};return r(P,{isOpen:n,onClose:d,maxWidth:"1300px",maxHeight:"90svh",children:f?r(S,{}):C(E,{children:[r(A,{id:"filled-basic",label:"Title",variant:"outlined",value:u,fullWidth:!0,onChange:g=>l(g.target.value),required:!0}),r("div",{style:{height:"65svh",width:"100%",marginTop:"1em"},children:r(I,{body:t,getBody:e})}),r(b,{variant:"outlined",disabled:u.trim()===""||t.trim()==="",onClick:y,fullWidth:!0,sx:{marginTop:"1.5em"},children:"Post"})]})})};export{D as A,k as d,B as p};
